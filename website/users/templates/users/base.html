<div id="chat-widget" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
    <div id="chat-box"
        style="display: none; width: 300px; height: 400px; background: white; border: 1px solid #ccc; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); flex-direction: column;">
        <div style="background: #2c3e50; color: white; padding: 10px; border-radius: 10px 10px 0 0; font-weight: bold;">
            ðŸ¤– Samanvay Assistant
            <span onclick="toggleChat()" style="float: right; cursor: pointer;">âœ–</span>
        </div>
        <div id="chat-messages" style="flex: 1; padding: 10px; overflow-y: auto; font-size: 0.9em;">
            <div style="margin-bottom: 10px; color: #555;">Hello! I can help you with Health or Agri services.</div>
        </div>
        <div style="padding: 10px; border-top: 1px solid #eee;">
            <input type="text" id="chat-input" placeholder="Ask me anything..." style="width: 70%; padding: 5px;">
            <button onclick="sendMessage()"
                style="padding: 5px 10px; background: #9b4dca; color: white; border: none; border-radius: 3px;">Send</button>
        </div>
    </div>

    <button onclick="toggleChat()"
        style="width: 60px; height: 60px; border-radius: 50%; background: #9b4dca; color: white; border: none; font-size: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); cursor: pointer;">
        ðŸ’¬
    </button>
</div>

<script>
    function toggleChat() {
        const box = document.getElementById('chat-box');
        box.style.display = box.style.display === 'none' ? 'flex' : 'none';
    }

    async function sendMessage() {
        const input = document.getElementById('chat-input');
        const messagesDiv = document.getElementById('chat-messages');
        const userText = input.value;
        if (!userText) return;

        // 1. Add User Message to UI
        messagesDiv.innerHTML += `<div style="text-align: right; margin: 5px; color: #9b4dca;"><b>You:</b> ${userText}</div>`;
        input.value = '';

        // 2. Send to Backend
        const response = await fetch('/citizen/chat', { // Note the /citizen prefix if using Blueprint
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: userText })
        });
        const data = await response.json();

        // 3. Add AI Response to UI
        messagesDiv.innerHTML += `<div style="text-align: left; margin: 5px; background: #f1f1f1; padding: 5px; border-radius: 5px;"><b>Samanvay:</b> ${data.response}</div>`;
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto scroll down
    }
</script>