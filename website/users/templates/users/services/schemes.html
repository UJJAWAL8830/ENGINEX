<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JanSetu | Scheme Matcher</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,600;0,700;1,600&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fffbeb;
        }

        h1,
        h2,
        h3 {
            font-family: 'Playfair Display', serif;
        }

        .custom-radio:checked+div {
            border-color: #d97706;
            background-color: #fff7ed;
            color: #d97706;
        }

        .fade-in-up {
            animation: fadeInUp 0.8s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="text-stone-800 antialiased">

    <nav class="fixed top-0 w-full z-50 bg-white/95 backdrop-blur-md border-b border-stone-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <a href="/citizen/home" class="flex items-center">
                    <span class="text-3xl font-extrabold text-stone-900 tracking-tight">JANSETU <span
                            class="text-amber-600">BENEFITS</span></span>
                </a>
                <a href="/citizen/home" class="text-sm font-bold text-stone-500 hover:text-amber-700">BACK TO HOME</a>
            </div>
        </div>
    </nav>

    <section class="pt-32 pb-12 px-4 max-w-4xl mx-auto text-center">
        <div
            class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-amber-100 text-amber-700 text-xs font-bold uppercase mb-4">
            <i data-lucide="sparkles" class="w-4 h-4"></i> AI Powered Eligibility Check
        </div>
        <h1 class="text-4xl md:text-5xl font-bold text-stone-900 mb-6">Find the perfect <span
                class="text-amber-600">Government Scheme</span> for you.</h1>
        <p class="text-lg text-stone-600">
            Tell our AI about yourself, and we will find the top 3 matches instantly.
        </p>
    </section>

    <section class="pb-20 px-4 max-w-3xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl border border-stone-200 overflow-hidden">
            <div class="bg-stone-50 px-8 py-4 border-b border-stone-100 flex justify-between items-center">
                <h3 class="font-bold text-stone-700">Your Profile</h3>
                <span class="text-xs text-stone-400">Step 1 of 1</span>
            </div>

            <div class="p-8 space-y-6">
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-stone-500 uppercase mb-2">Age</label>
                        <input type="number" id="inAge" placeholder="e.g. 24"
                            class="w-full p-3 border border-stone-300 rounded-lg focus:ring-2 focus:ring-amber-500 outline-none transition">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-stone-500 uppercase mb-2">Gender</label>
                        <select id="inGender"
                            class="w-full p-3 border border-stone-300 rounded-lg outline-none bg-white">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-stone-500 uppercase mb-2">Occupation</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <label class="cursor-pointer"><input type="radio" name="occ" value="Student"
                                class="custom-radio hidden" checked>
                            <div
                                class="border border-stone-200 rounded-lg p-3 text-center hover:bg-stone-50 transition">
                                <span class="text-sm font-bold">Student</span></div>
                        </label>
                        <label class="cursor-pointer"><input type="radio" name="occ" value="Farmer"
                                class="custom-radio hidden">
                            <div
                                class="border border-stone-200 rounded-lg p-3 text-center hover:bg-stone-50 transition">
                                <span class="text-sm font-bold">Farmer</span></div>
                        </label>
                        <label class="cursor-pointer"><input type="radio" name="occ" value="Business"
                                class="custom-radio hidden">
                            <div
                                class="border border-stone-200 rounded-lg p-3 text-center hover:bg-stone-50 transition">
                                <span class="text-sm font-bold">Business</span></div>
                        </label>
                        <label class="cursor-pointer"><input type="radio" name="occ" value="Unemployed"
                                class="custom-radio hidden">
                            <div
                                class="border border-stone-200 rounded-lg p-3 text-center hover:bg-stone-50 transition">
                                <span class="text-sm font-bold">None</span></div>
                        </label>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-stone-500 uppercase mb-2">Annual Family Income
                            (â‚¹)</label>
                        <input type="number" id="inIncome" placeholder="e.g. 150000"
                            class="w-full p-3 border border-stone-300 rounded-lg focus:ring-2 focus:ring-amber-500 outline-none transition">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-stone-500 uppercase mb-2">State</label>
                        <select id="inState"
                            class="w-full p-3 border border-stone-300 rounded-lg outline-none bg-white">
                            <option value="Gujarat">Gujarat</option>
                            <option value="Maharashtra">Maharashtra</option>
                            <option value="Rajasthan">Rajasthan</option>
                            <option value="Delhi">Delhi</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-stone-500 uppercase mb-2">Category</label>
                    <select id="inCategory" class="w-full p-3 border border-stone-300 rounded-lg outline-none bg-white">
                        <option value="General">General</option>
                        <option value="OBC">OBC</option>
                        <option value="SC/ST">SC / ST</option>
                        <option value="EWS">EWS</option>
                    </select>
                </div>

                <button onclick="findSchemes()" id="btnFind"
                    class="w-full bg-stone-900 text-white font-bold py-4 rounded-xl hover:bg-black transition shadow-lg flex justify-center items-center gap-2 text-lg">
                    <span>Find My Schemes</span>
                    <i data-lucide="search" class="w-5 h-5"></i>
                </button>
            </div>
        </div>

        <div id="resultsArea" class="hidden mt-12 space-y-6 fade-in-up">
            <h2 class="text-2xl font-bold text-stone-800 text-center">We found 3 Schemes for you</h2>
            <div id="cardsContainer" class="space-y-6">
            </div>
        </div>
    </section>

    <script>
        lucide.createIcons();

        async function findSchemes() {
            const btn = document.getElementById('btnFind');
            const resultsArea = document.getElementById('resultsArea');
            const container = document.getElementById('cardsContainer');

            const payload = {
                age: document.getElementById('inAge').value,
                gender: document.getElementById('inGender').value,
                occupation: document.querySelector('input[name="occ"]:checked').value,
                income: document.getElementById('inIncome').value,
                state: document.getElementById('inState').value,
                category: document.getElementById('inCategory').value
            };

            if (!payload.age || !payload.income) { alert("Please enter Age and Income."); return; }

            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-5 h-5"></i> Matching Schemes...`;
            btn.disabled = true;
            resultsArea.classList.add('hidden');

            try {
                const response = await fetch('/citizen/find-schemes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();

                if (data.error) throw new Error(data.error);

                const result = JSON.parse(data.analysis);
                container.innerHTML = "";

                result.schemes.forEach(scheme => {
                    let docsHtml = (scheme.documents_needed || []).map(doc =>
                        `<li class="flex items-center gap-2"><i data-lucide="check" class="w-3 h-3 text-green-500"></i> ${doc}</li>`
                    ).join('');

                    let probColor = scheme.approval_chance === "High" ? "bg-green-100 text-green-800" : "bg-yellow-100 text-yellow-800";

                    // --- LINK FALLBACK LOGIC ---
                    let finalLink = scheme.application_url;
                    // If link is bad, "SEARCH", or doesn't start with http, use Google Search
                    if (!finalLink || finalLink === "SEARCH" || !finalLink.startsWith("http")) {
                        finalLink = `https://www.google.com/search?q=${encodeURIComponent(scheme.name + " official website apply online")}`;
                    }

                    const card = `
                        <div class="bg-white rounded-xl shadow-md border border-stone-200 overflow-hidden hover:shadow-xl transition-all duration-300">
                            <div class="p-6">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <p class="text-xs font-bold text-stone-400 uppercase tracking-wider">${scheme.ministry}</p>
                                        <h3 class="text-xl font-bold text-stone-900 mt-1">${scheme.name}</h3>
                                    </div>
                                    <span class="px-3 py-1 rounded-full text-xs font-bold ${probColor}">${scheme.approval_chance} Probability</span>
                                </div>
                                <p class="text-stone-600 mb-6 leading-relaxed">${scheme.benefits}</p>
                                <div class="bg-stone-50 rounded-lg p-4 border border-stone-100">
                                    <h4 class="text-xs font-bold text-stone-500 uppercase mb-3 flex items-center gap-2"><i data-lucide="file-text" class="w-4 h-4"></i> Documents Required</h4>
                                    <ul class="text-sm text-stone-600 space-y-2 grid grid-cols-1 md:grid-cols-2">${docsHtml}</ul>
                                </div>
                                
                                <a href="${finalLink}" target="_blank" class="w-full mt-6 bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 rounded-lg transition-colors flex justify-center items-center gap-2 text-center decoration-none">
                                    Apply on Official Site <i data-lucide="external-link" class="w-4 h-4"></i>
                                </a>
                            </div>
                        </div>
                    `;
                    container.innerHTML += card;
                });

                resultsArea.classList.remove('hidden');
                resultsArea.scrollIntoView({ behavior: 'smooth' });

            } catch (e) {
                console.error(e);
                alert("Service busy. Try again.");
            } finally {
                btn.innerHTML = `<span>Find My Schemes</span> <i data-lucide="search" class="w-5 h-5"></i>`;
                btn.disabled = false;
                lucide.createIcons();
            }
        }
    </script>
</body>

</html>